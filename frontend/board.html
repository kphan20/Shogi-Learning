<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]>      <html class="no-js"> <!--<![endif]-->
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <style>
            #shogi-board { border-spacing: 0; border-collapse: collapse; margin-left: auto; margin-right: auto;}
            #shogi-board th { padding: .5em; }
            #shogi-board td { border: 1px solid; width: 3em; height: 3em; }
            td.light { background: #eee; }
            td.move-dest { background: #eee radial-gradient(rgba(20,85,30,0.5) 19%, rgba(0,0,0,0) 20%)}
        </style>
        <link rel="stylesheet" href="">
    </head>
    <body>
        <table id="shogi-board">
            <tbody>
                <tr>
                    <th>9</th>
                    <th>8</th>
                    <th>7</th>
                    <th>6</th>
                    <th>5</th>
                    <th>4</th>
                    <th>3</th>
                    <th>2</th>
                    <th>1</th>
                    <th></th>
                </tr>
                <tr>
                    <td class="light" align="center"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <th>1</th>
                </tr>
                <tr>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <th>2</th>
                </tr>
                <tr>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <th>3</th>
                </tr>
                <tr>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <th>4</th>
                </tr>
                <tr>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <th>5</th>
                </tr>
                <tr>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <th>6</th>
                </tr>
                <tr>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <th>7</th>
                </tr>
                <tr>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <th>8</th>
                </tr>
                <tr>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <td class="light"></td>
                    <th>9</th>
                </tr>
            </tbody>
        </table>
        
        <a href="index.html">Back to main menu</a>
        <script src="gamelogic.js" async defer></script>
        <script src="node_modules/socket.io-client/dist/socket.io.js"></script>
        <script>
            const socket = io.connect("http://localhost:5000");
            socket.on("message", function (message) {
                console.log(message);
            });
            socket.on('after connect', function (message) {
                console.log(message);
            })
            socket.on('possible moves', function (moves) {
                console.log(moves);
                clearDestCells();
                const board = document.getElementById("shogi-board");
                moves.forEach((move) => {
                    const cell = board.rows[move[1][0] + 1].cells[move[1][1]];
                    cell.classList.add('move-dest');
                    if (move[2]) cell.classList.add('promote');
                })
            })
            document.querySelectorAll('.piece').forEach((piece) => {
                piece.addEventListener("click", function (e) {
                    socket.emit("json", "hello");
                    if (piece.classList.contains(playerColorStr)) {
                        const data = {'color': playerColor, 'board': getBoard(),
                        'rank': parseInt(piece.parentElement.parentElement.rowIndex) - 1,
                        'file': parseInt(piece.parentElement.cellIndex)};
                        socket.emit("move", data);
                    }
                });
            })
        </script>
    </body>
</html>